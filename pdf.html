<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple PDF Reader</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PDF.js library from Mozilla -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom styles for a better look and feel */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Hide the default file input */
        #pdf-upload {
            display: none;
        }
        /* Style the custom upload button */
        #upload-label {
            cursor: pointer;
        }
        /* Custom scrollbar for the viewer */
        #pdf-viewer-container::-webkit-scrollbar {
            width: 8px;
        }
        #pdf-viewer-container::-webkit-scrollbar-track {
            background: #2d3748; /* gray-800 */
        }
        #pdf-viewer-container::-webkit-scrollbar-thumb {
            background: #718096; /* gray-500 */
            border-radius: 4px;
        }
        #pdf-viewer-container::-webkit-scrollbar-thumb:hover {
            background: #a0aec0; /* gray-400 */
        }
        /* Remove arrows from number input */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }
        input[type=number] {
          -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col h-screen">

    <!-- Header Section with Controls -->
    <header class="bg-gray-800 shadow-lg p-3 sm:p-4 sticky top-0 z-20">
        <div class="container mx-auto flex flex-wrap justify-between items-center">
            <h1 class="text-xl sm:text-2xl font-bold text-gray-200 mr-4">PDF Reader</h1>

            <!-- Controls: Visible only after a PDF is loaded -->
            <div id="pdf-controls" class="hidden items-center space-x-2 sm:space-x-4">
                 <div class="flex items-center space-x-1 text-sm sm:text-base">
                    <span>Page:</span>
                    <input type="number" id="page-num-input" value="0" class="bg-gray-900 border border-gray-600 text-white font-mono w-14 text-center rounded p-1 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    <span>/</span>
                    <span id="page-count" class="font-mono">0</span>
                </div>

                <div class="h-6 w-px bg-gray-600"></div>

                <button id="zoom-out" class="control-btn" title="Zoom Out">
                    <i class="fas fa-search-minus"></i>
                </button>
                 <button id="zoom-in" class="control-btn" title="Zoom In">
                    <i class="fas fa-search-plus"></i>
                </button>
            </div>

            <!-- File Upload Button -->
            <label id="upload-label" for="pdf-upload" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 shadow-md">
                <i class="fas fa-folder-open mr-2"></i>
                <span>Open PDF</span>
            </label>
            <input type="file" id="pdf-upload" accept="application/pdf">
        </div>
    </header>

    <!-- Main Content: PDF Viewer -->
    <main id="pdf-viewer-container" class="flex-grow flex flex-col items-center p-4 bg-gray-900 overflow-auto space-y-4">
        <!-- Initial Message / Loader -->
        <div id="initial-message" class="flex flex-col items-center justify-center h-full text-gray-500">
             <svg class="w-24 h-24 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
            <h2 class="text-2xl font-semibold">Select a PDF file to get started</h2>
            <p class="mt-2">Your document will be displayed here.</p>
        </div>
        <!-- Canvases for rendering PDF pages will be appended here -->
    </main>

    <script>
        // Set the workerSrc for pdf.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js`;

        // DOM Elements
        const fileInput = document.getElementById('pdf-upload');
        const viewerContainer = document.getElementById('pdf-viewer-container');
        const initialMessage = document.getElementById('initial-message');
        const controls = document.getElementById('pdf-controls');
        const pageNumInput = document.getElementById('page-num-input');
        const pageCountEl = document.getElementById('page-count');
        const zoomInBtn = document.getElementById('zoom-in');
        const zoomOutBtn = document.getElementById('zoom-out');
        const uploadLabel = document.getElementById('upload-label');

        // State
        let pdfDoc = null;
        let scale = 1.5;
        let pageObserver = null;

        // Render all pages of the PDF
        const renderAllPages = async () => {
            viewerContainer.innerHTML = ''; // Clear previous content
            
            // Use a DocumentFragment for performance
            const fragment = document.createDocumentFragment();

            for (let num = 1; num <= pdfDoc.numPages; num++) {
                const page = await pdfDoc.getPage(num);
                const viewport = page.getViewport({ scale });
                
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                canvas.dataset.pageNumber = num;
                canvas.classList.add('shadow-2xl', 'rounded-lg');

                fragment.appendChild(canvas);

                const renderContext = {
                    canvasContext: ctx,
                    viewport
                };
                page.render(renderContext);
            }
            viewerContainer.appendChild(fragment);
            setupPageObserver();
        };

        // Set up Intersection Observer to track current page
        const setupPageObserver = () => {
            if(pageObserver) {
                pageObserver.disconnect();
            }

            const options = {
                root: viewerContainer,
                rootMargin: "-50% 0px -50% 0px", // Trigger when page is in the vertical center
                threshold: 0
            };

            pageObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const pageNum = entry.target.dataset.pageNumber;
                        pageNumInput.value = pageNum;
                    }
                });
            }, options);
            
            document.querySelectorAll('#pdf-viewer-container canvas').forEach(canvas => {
                pageObserver.observe(canvas);
            });
        };


        // Zoom In
        const zoomIn = () => {
            if (scale >= 3.0) return; // Max zoom level
            scale += 0.25;
            renderAllPages();
        };
        
        // Zoom Out
        const zoomOut = () => {
            if (scale <= 0.5) return; // Min zoom level
            scale -= 0.25;
            renderAllPages();
        };

        // Handle go to page from input
        const goToPage = (e) => {
            const desiredPage = parseInt(e.target.value);
            if (!isNaN(desiredPage) && desiredPage >= 1 && desiredPage <= pdfDoc.numPages) {
                const targetCanvas = viewerContainer.querySelector(`canvas[data-page-number='${desiredPage}']`);
                if (targetCanvas) {
                    targetCanvas.scrollIntoView({
                        behavior: 'auto',
                        block: 'start'
                    });
                }
            }
        };


        // Handle file selection
        fileInput.addEventListener('change', e => {
            const file = e.target.files[0];
            if (!file || file.type !== 'application/pdf') {
                return;
            }

            const fileReader = new FileReader();
            fileReader.onload = function() {
                const typedarray = new Uint8Array(this.result);
                const loadingTask = pdfjsLib.getDocument(typedarray);
                
                // Clear viewer and show loader
                viewerContainer.innerHTML = '';
                initialMessage.innerHTML = `<div class="text-center"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mx-auto"></div><p class="mt-4">Loading Document...</p></div>`;
                initialMessage.classList.remove('hidden');

                loadingTask.promise.then(pdfDoc_ => {
                    pdfDoc = pdfDoc_;
                    pageCountEl.textContent = pdfDoc.numPages;
                    pageNumInput.value = '1';

                    renderAllPages();

                    // Show controls and hide initial message
                    controls.classList.remove('hidden');
                    controls.classList.add('flex');
                    initialMessage.classList.add('hidden');
                    uploadLabel.querySelector('span').textContent = 'Change PDF';

                }).catch(err => {
                     viewerContainer.innerHTML = '';
                     initialMessage.innerHTML = `<div class="text-red-400 text-center"><i class="fas fa-exclamation-triangle text-4xl mb-4"></i><p>Error loading PDF.</p><p class="text-sm text-gray-500">${err.message}</p></div>`;
                     initialMessage.classList.remove('hidden');
                     controls.classList.add('hidden');
                });
            };
            fileReader.readAsArrayBuffer(file);
        });

        // Event Listeners
        zoomInBtn.addEventListener('click', zoomIn);
        zoomOutBtn.addEventListener('click', zoomOut);
        pageNumInput.addEventListener('change', goToPage);
        
        // Add Tailwind classes to control buttons for consistent styling
        document.querySelectorAll('.control-btn').forEach(btn => {
           btn.classList.add('bg-gray-700', 'hover:bg-gray-600', 'text-white', 'font-bold', 'py-2', 'px-3', 'rounded-md', 'transition-all', 'duration-200');
        });

    </script>
</body>
</html>

